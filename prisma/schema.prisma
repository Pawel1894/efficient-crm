generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider     = "mysql"
    url          = env("DATABASE_URL")
    relationMode = "prisma"
}

model UserControl {
    id            String @id @default(cuid())
    userId        String
    lastActiveOrg String
}

model Lead {
    id         String     @id @default(cuid())
    activities Activity[]
    deals      Deal[]
    owner      String
    status     String     @db.Text
    comment    String?    @db.LongText
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
    createdBy  String
    updatedBy  String

    contact Contact @relation(fields: [contactId], references: [id])

    creatorId String
    editorId  String
    contactId String
    ownerId   String?

    @@index([creatorId])
    @@index([editorId])
    @@index([contactId])
    @@index([ownerId])
    @@index([contactId, ownerId])
}

model Deal {
    id               String   @id @default(cuid())
    forecast         Float    @db.Float
    value            Float    @db.Float
    owner            String
    stage            String   @db.Text
    comment          String?  @db.LongText
    closeProbability Float    @db.Float
    lead             Lead?    @relation(fields: [leadId], references: [id])
    createdBy        String
    updatedBy        String
    createdAt        DateTime @default(now())
    updatedAt        DateTime @updatedAt

    leadId    String?
    creatorId String
    editorId  String
    ownerId   String?

    @@index([leadId])
    @@index([creatorId])
    @@index([editorId])
    @@index([ownerId])
    @@index([leadId, ownerId])
}

model Contact {
    id         String     @id @default(cuid())
    firstName  String
    lastName   String
    company    String
    title      String
    email      String
    phone      String
    location   String
    comment    String
    owner      String
    type       String
    activities Activity[]
    leads      Lead[]
    createdBy  String
    updatedBy  String
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
    orgId      String
    orgSlug    String

    editorId  String
    creatorId String
    ownerId   String

    @@index([editorId])
    @@index([creatorId])
    @@index([ownerId])
}

model Activity {
    id        String   @id @default(cuid())
    owner     String
    startTime DateTime
    endTime   DateTime
    status    String
    type      String
    contact   Contact? @relation(fields: [contactId], references: [id])
    Lead      Lead?    @relation(fields: [leadId], references: [id])

    leadId    String?
    contactId String?
    ownerId   String

    @@index([leadId])
    @@index([contactId])
    @@index([ownerId])
    @@index([ownerId, contactId])
    @@index([ownerId, leadId])
}

model Dictionary {
    id    String @id @default(cuid())
    type  Type
    value String
    label String
    orgId String
}

enum Type {
    ACTIVITY_STATUS
    CONTACT_TYPE
    DEAL_STAGE
    LEAD_STATUS
}
